
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <title>JSON · Introducción a Elm</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="HonKit 5.1.4">
        <meta name="author" content="Evan Czaplicki">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/@honkit/honkit-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="random.html" />
    
    
    <link rel="prev" href="http.html" />
    

    </head>
    <body>
        
<div class="book honkit-cloak">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introducción
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../core_language.html">
            
                <a href="../core_language.html">
            
                    
                    Lo esencial del lenguaje
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../architecture/">
            
                <a href="../architecture/">
            
                    
                    Arquitectura Elm
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../architecture/buttons.html">
            
                <a href="../architecture/buttons.html">
            
                    
                    Botones
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../architecture/text_fields.html">
            
                <a href="../architecture/text_fields.html">
            
                    
                    Campos de texto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../architecture/forms.html">
            
                <a href="../architecture/forms.html">
            
                    
                    Formularios
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../types/">
            
                <a href="../types/">
            
                    
                    Tipos
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../types/reading_types.html">
            
                <a href="../types/reading_types.html">
            
                    
                    Leyendo tipos
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../types/type_aliases.html">
            
                <a href="../types/type_aliases.html">
            
                    
                    Alias de tipo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../types/custom_types.html">
            
                <a href="../types/custom_types.html">
            
                    
                    Tipos personalizados
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../types/pattern_matching.html">
            
                <a href="../types/pattern_matching.html">
            
                    
                    Búsqueda de patrones
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../error_handling/">
            
                <a href="../error_handling/">
            
                    
                    Manejo de errores
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../error_handling/maybe.html">
            
                <a href="../error_handling/maybe.html">
            
                    
                    Maybe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../error_handling/result.html">
            
                <a href="../error_handling/result.html">
            
                    
                    Result
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="./">
            
                <a href="./">
            
                    
                    Comandos y suscripciones
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="http.html">
            
                <a href="http.html">
            
                    
                    HTTP
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.2" data-path="json.html">
            
                <a href="json.html">
            
                    
                    JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="random.html">
            
                <a href="random.html">
            
                    
                    Valores aleatorios
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="time.html">
            
                <a href="time.html">
            
                    
                    Tiempo
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../install/">
            
                <a href="../install/">
            
                    
                    Instalación
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../install/editor.html">
            
                <a href="../install/editor.html">
            
                    
                    Editor de código
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../install/elm.html">
            
                <a href="../install/elm.html">
            
                    
                    Elm
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../interop/">
            
                <a href="../interop/">
            
                    
                    JavaScript Interop
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../interop/flags.html">
            
                <a href="../interop/flags.html">
            
                    
                    Flags
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../interop/ports.html">
            
                <a href="../interop/ports.html">
            
                    
                    Ports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../interop/custom_elements.html">
            
                <a href="../interop/custom_elements.html">
            
                    
                    Custom Elements
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../interop/limits.html">
            
                <a href="../interop/limits.html">
            
                    
                    Limits
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../webapps/">
            
                <a href="../webapps/">
            
                    
                    Web Apps
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../webapps/navigation.html">
            
                <a href="../webapps/navigation.html">
            
                    
                    Navigation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../webapps/url_parsing.html">
            
                <a href="../webapps/url_parsing.html">
            
                    
                    URL Parsing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../webapps/modules.html">
            
                <a href="../webapps/modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../webapps/structure.html">
            
                <a href="../webapps/structure.html">
            
                    
                    Structure
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../optimization/">
            
                <a href="../optimization/">
            
                    
                    Optimization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../optimization/lazy.html">
            
                <a href="../optimization/lazy.html">
            
                    
                    Html.lazy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../optimization/keyed.html">
            
                <a href="../optimization/keyed.html">
            
                    
                    Html.keyed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../optimization/asset_size.html">
            
                <a href="../optimization/asset_size.html">
            
                    
                    Minification
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../next_steps.html">
            
                <a href="../next_steps.html">
            
                    
                    Next Steps
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" >
            
                <span>
            
                    
                    Appendix
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.12.1" data-path="../appendix/types_as_sets.html">
            
                <a href="../appendix/types_as_sets.html">
            
                    
                    Types as Sets
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.2" data-path="../appendix/types_as_bits.html">
            
                <a href="../appendix/types_as_bits.html">
            
                    
                    Types as Bits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12.3" data-path="../appendix/function_types.html">
            
                <a href="../appendix/function_types.html">
            
                    
                    Function Types
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://github.com/honkit/honkit" target="blank" class="gitbook-link">
            Published with HonKit
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >JSON</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="json">JSON</h1>
<p>Recién vimos un ejemplo que usa HTTP para obtener el contenido de un libro. Muy útil, pero muchos servidores retornan datos en un formato especial llamado JSON.</p>
<p>Nuestro siguiente ejemplo demuestra cómo recuperar datos JSON, permitiéndonos apretar un botón para ver citas al azar desde una selección variada de libros. Apreta el botón azul “Editar” para echarle una mirada al programa. ¿Tal vez ya leíste algunos de esos libros? <strong>Apreta el botón azul.</strong></p>
<div class="edit-link"><a href="https://elm-lang.org/examples/quotes" target="_blank">Editar</a></div>

<pre><code class="lang-elm"><span class="hljs-keyword">import</span> Browser
<span class="hljs-keyword">import</span> Html <span class="hljs-keyword">exposing</span> (..)
<span class="hljs-keyword">import</span> Html.Attributes <span class="hljs-keyword">exposing</span> (style)
<span class="hljs-keyword">import</span> Html.Events <span class="hljs-keyword">exposing</span> (..)
<span class="hljs-keyword">import</span> Http
<span class="hljs-keyword">import</span> Json.Decode <span class="hljs-keyword">exposing</span> (<span class="hljs-type">Decoder</span>, field, int, map4, string)



<span class="hljs-comment">-- MAIN</span>


<span class="hljs-title">main</span> =
    <span class="hljs-type">Browser</span>.element
        { init = init
        , update = update
        , subscriptions = subscriptions
        , view = view
        }



<span class="hljs-comment">-- MODEL</span>


<span class="hljs-keyword">type</span> <span class="hljs-type">Model</span>
    = <span class="hljs-type">Failure</span>
    | <span class="hljs-type">Loading</span>
    | <span class="hljs-type">Success</span> <span class="hljs-type">Quote</span>


<span class="hljs-keyword">type</span> <span class="hljs-keyword">alias</span> <span class="hljs-type">Quote</span> =
    { quote : <span class="hljs-type">String</span>
    , source : <span class="hljs-type">String</span>
    , author : <span class="hljs-type">String</span>
    , year : <span class="hljs-type">Int</span>
    }


<span class="hljs-title">init</span> : () -&gt; ( <span class="hljs-type">Model</span>, <span class="hljs-type">Cmd</span> <span class="hljs-type">Msg</span> )
<span class="hljs-title">init</span> _ =
    ( <span class="hljs-type">Loading</span>, getRandomQuote )



<span class="hljs-comment">-- UPDATE</span>


<span class="hljs-keyword">type</span> <span class="hljs-type">Msg</span>
    = <span class="hljs-type">MorePlease</span>
    | <span class="hljs-type">GotQuote</span> (<span class="hljs-type">Result</span> <span class="hljs-type">Http</span>.<span class="hljs-type">Error</span> <span class="hljs-type">Quote</span>)


<span class="hljs-title">update</span> : <span class="hljs-type">Msg</span> -&gt; <span class="hljs-type">Model</span> -&gt; ( <span class="hljs-type">Model</span>, <span class="hljs-type">Cmd</span> <span class="hljs-type">Msg</span> )
<span class="hljs-title">update</span> msg model =
    <span class="hljs-keyword">case</span> msg <span class="hljs-keyword">of</span>
        <span class="hljs-type">MorePlease</span> -&gt;
            ( <span class="hljs-type">Loading</span>, getRandomQuote )

        <span class="hljs-type">GotQuote</span> result -&gt;
            <span class="hljs-keyword">case</span> result <span class="hljs-keyword">of</span>
                <span class="hljs-type">Ok</span> quote -&gt;
                    ( <span class="hljs-type">Success</span> quote, <span class="hljs-type">Cmd</span>.none )

                <span class="hljs-type">Err</span> _ -&gt;
                    ( <span class="hljs-type">Failure</span>, <span class="hljs-type">Cmd</span>.none )



<span class="hljs-comment">-- SUBSCRIPTIONS</span>


<span class="hljs-title">subscriptions</span> : <span class="hljs-type">Model</span> -&gt; <span class="hljs-type">Sub</span> <span class="hljs-type">Msg</span>
<span class="hljs-title">subscriptions</span> model =
    <span class="hljs-type">Sub</span>.none



<span class="hljs-comment">-- VIEW</span>


<span class="hljs-title">view</span> : <span class="hljs-type">Model</span> -&gt; <span class="hljs-type">Html</span> <span class="hljs-type">Msg</span>
<span class="hljs-title">view</span> model =
    div []
        [ h2 [] [ text <span class="hljs-string">"Random Quotes"</span> ]
        , viewQuote model
        ]


<span class="hljs-title">viewQuote</span> : <span class="hljs-type">Model</span> -&gt; <span class="hljs-type">Html</span> <span class="hljs-type">Msg</span>
<span class="hljs-title">viewQuote</span> model =
    <span class="hljs-keyword">case</span> model <span class="hljs-keyword">of</span>
        <span class="hljs-type">Failure</span> -&gt;
            div []
                [ text <span class="hljs-string">"I could not load a random quote for some reason. "</span>
                , button [ onClick <span class="hljs-type">MorePlease</span> ] [ text <span class="hljs-string">"Try Again!"</span> ]
                ]

        <span class="hljs-type">Loading</span> -&gt;
            text <span class="hljs-string">"Loading..."</span>

        <span class="hljs-type">Success</span> quote -&gt;
            div []
                [ button [ onClick <span class="hljs-type">MorePlease</span>, style <span class="hljs-string">"display"</span> <span class="hljs-string">"block"</span> ] [ text <span class="hljs-string">"More Please!"</span> ]
                , blockquote [] [ text quote.quote ]
                , p [ style <span class="hljs-string">"text-align"</span> <span class="hljs-string">"right"</span> ]
                    [ text <span class="hljs-string">"— "</span>
                    , cite [] [ text quote.source ]
                    , text (<span class="hljs-string">" by "</span> ++ quote.author ++ <span class="hljs-string">" ("</span> ++ <span class="hljs-type">String</span>.fromInt quote.year ++ <span class="hljs-string">")"</span>)
                    ]
                ]



<span class="hljs-comment">-- HTTP</span>


<span class="hljs-title">getRandomQuote</span> : <span class="hljs-type">Cmd</span> <span class="hljs-type">Msg</span>
<span class="hljs-title">getRandomQuote</span> =
    <span class="hljs-type">Http</span>.get
        { url = <span class="hljs-string">"https://elm-lang.org/api/random-quotes"</span>
        , expect = <span class="hljs-type">Http</span>.expectJson <span class="hljs-type">GotQuote</span> quoteDecoder
        }


<span class="hljs-title">quoteDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">Quote</span>
<span class="hljs-title">quoteDecoder</span> =
    map4 <span class="hljs-type">Quote</span>
        (field <span class="hljs-string">"quote"</span> string)
        (field <span class="hljs-string">"source"</span> string)
        (field <span class="hljs-string">"author"</span> string)
        (field <span class="hljs-string">"year"</span> int)
</code></pre>
<p>Este ejemplo se parece mucho al anterior:</p>
<ul>
<li><code>init</code> inicializa con el estado <code>Loading</code>, junto con un comando que recupera una cita al azar.</li>
<li><code>update</code> maneja el mensaje <code>GotQuote</code> recibido cuando una nueva cita está disponible. Sea lo que sea que ocurra, no tenemos nuevos comandos. También maneja el mensaje <code>MorePlease</code> cuando alguien apreta el botón, y la respuesta es enviar un comando para obtener más citas.</li>
<li><code>view</code> muestra las citas.</li>
</ul>
<p>La principal diferencia está en la definición de <code>getRandomQuote</code>. En vez de usar <code>Http.expectString</code>, lo hemos cambiado a <code>Http.expectJson</code>. ¿Qué significa esto?</p>
<h2 id="json">JSON</h2>
<p>Si le pides a <a href="https://elm-lang.org/api/random-quotes" target="_blank"><code>/api/random-quotes</code></a> una cita aleatoria, el servidor produce un poco de JSON que se parece a esto:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"quote"</span>: <span class="hljs-string">"December used to be a month but it is now a year"</span>,
  <span class="hljs-string">"source"</span>: <span class="hljs-string">"Letters from a Stoic"</span>,
  <span class="hljs-string">"author"</span>: <span class="hljs-string">"Seneca"</span>,
  <span class="hljs-string">"year"</span>: <span class="hljs-number">54</span>
}
</code></pre>
<p>No tenemos garantías sobre ninguna de esta información. El servidor podría cambiar el nombre de los campos, y los campos podrían tener datos de distinto tipo en distintas situaciones. El mundo es así, caótico.</p>
<p>En JavaScript, lo normal es convertir ese JSON en objetos nativos de JavaScript, y cruzar los dedos para que todo salga bien. Pero si tecleaste mal el nombre de un campo, o vienen datos inesperados, tu código va a lanzar una excepción. ¿El código estaba mal, o tal vez los datos estaban mal…? No podemos saberlo sin empezar a investigar.</p>
<p>En Elm, validamos el JSON antes de que entre a nuestro programa. Si los datos vienen con una estructura que no era la que esperábamos, inmediatamente los abemos. No hay ninguna forma de que datos incorrectos se cuelen entre las rendijas y causen una excepción en tiempo de ejecución tres archivos más allá. Este es el propósito de los decodificadores de JSON.</p>
<h2 id="decodificadores-de-json">Decodificadores de JSON</h2>
<p>Digamos que tenemos este JSON:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Tom"</span>,
  <span class="hljs-string">"age"</span>: <span class="hljs-number">42</span>
}
</code></pre>
<p>Tendremos que pasarlo por un <code>Decoder</code> para acceder información específica contenida ahí. Si queremos obtener el campo <code>"age"</code>, pasamos el JSON por un <code>Decoder Int</code> que describe exactamente cómo acceder a esa información.</p>
<p><img src="diagrams/int.svg" alt=""></img></p>
<p>Si todo sale bien, del otro lado obtendremos un valor <code>Int</code>. Y si quisiéramos el campo <code>"name"</code>, tendríamos que pasar el JSON por un decodificador <code>Decoder String</code> que describe exactamente cómo recuperarlo:</p>
<p><img src="diagrams/string.svg" alt=""></img></p>
<p>Y nuevamente, si todo sale bien, del otro lado obtendremos un valor <code>String</code>.</p>
<p>¿Cómo creamos decodificadores como estos?</p>
<h2 id="elementos-básicos">Elementos básicos</h2>
<p>El paquete <a href="https://package.elm-lang.org/packages/elm/json/latest/" target="_blank"><code>elm/json</code></a> nos ofrece el módulo <a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode" target="_blank"><code>Json.Decode</code></a>. Está lleno de pequeños decodificadores diseñados para usarse en conjunto.</p>
<p>Para obtener el campo <code>"age"</code> de <code>{ "name": "Tom", "age": 42 }</code>, necesitamos crear un decodificador como este:</p>
<pre><code class="lang-elm"><span class="hljs-keyword">import</span> Json.Decode <span class="hljs-keyword">exposing</span> (<span class="hljs-type">Decoder</span>, field, int)


<span class="hljs-title">ageDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">Int</span>
<span class="hljs-title">ageDecoder</span> =
    field <span class="hljs-string">"age"</span> int



<span class="hljs-comment">-- int : Decoder Int</span>
<span class="hljs-comment">-- field : String -&gt; Decoder a -&gt; Decoder a</span>
</code></pre>
<p>La función <a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#field" target="_blank"><code>field</code></a> recibe dos argumentos:</p>
<ol>
<li><code>String</code> — nombre de un campo. Aquí, requerimos un objeto con un campo <code>"age"</code>.</li>
<li><code>Decoder a</code> — un decodificador para el valor. Si el campo <code>"age"</code> existe, tratamos de pasar su valor por este decodificador.</li>
</ol>
<p>Juntándolo todo, <code>field "age" int</code> dice que necesitamos un campo <code>"age"</code>, y si existe, lo pasamos por el decodificador <code>Decoder Int</code> para recuperar un número entero.</p>
<p>Hacemos casi lo mismo para extraer el campo <code>"name"</code>:</p>
<pre><code class="lang-elm"><span class="hljs-keyword">import</span> Json.Decode <span class="hljs-keyword">exposing</span> (<span class="hljs-type">Decoder</span>, field, string)


<span class="hljs-title">nameDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">String</span>
<span class="hljs-title">nameDecoder</span> =
    field <span class="hljs-string">"name"</span> string



<span class="hljs-comment">-- string : Decoder String</span>
</code></pre>
<p>En este caso, necesitamos un campo <code>"name"</code>, y si existe, queremos que su valor sea <code>String</code>.</p>
<h2 id="combinando-decodificadores">Combinando decodificadores</h2>
<p>¿Y qué pasa si necesitamos decodificar <em>dos</em> campos? Podemos conjugar decodificadores con <a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#map2" target="_blank"><code>map2</code></a>:</p>
<pre><code class="lang-elm"><span class="hljs-title">map2</span> : (a -&gt; b -&gt; value) -&gt; <span class="hljs-type">Decoder</span> a -&gt; <span class="hljs-type">Decoder</span> b -&gt; <span class="hljs-type">Decoder</span> value
</code></pre>
<p>Esta función recibe dos decodificadores, pasa el JSON por ambos, y combina sus resultados. Con ella podemos juntar dos decodificadores así:</p>
<pre><code class="lang-elm"><span class="hljs-keyword">import</span> Json.Decode <span class="hljs-keyword">exposing</span> (<span class="hljs-type">Decoder</span>, map2, field, string, int)

<span class="hljs-keyword">type</span> <span class="hljs-keyword">alias</span> <span class="hljs-type">Person</span> =
  { name : <span class="hljs-type">String</span>
  , age : <span class="hljs-type">Int</span>
  }

<span class="hljs-title">personDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">Person</span>
<span class="hljs-title">personDecoder</span> =
  map2 <span class="hljs-type">Person</span>
      (field <span class="hljs-string">"name"</span> string)
      (field <span class="hljs-string">"age"</span> int)
</code></pre>
<p>Si usáramos <code>personDecoder</code> en <code>{ "name": "Tom", "age": 42 }</code>, recuperaríamos un valor Elm como <code>Person "Tom" 42</code>.</p>
<p>Y para entrar en el espíritu de los decodificadores como piezas combinables, definiríamos <code>personDecoder</code> como <code>map2 Person nameDecoder ageDecoder</code> usando nuestros decodificadores definidos anteriormente. O sea, la gracia está en armar decodificadores más grandes a partir de otros más pequeños.</p>
<h2 id="anidar-decodificadores">Anidar decodificadores</h2>
<p>Muchos datos JSON no son tan planos. Imagina si existiera <code>/api/random-quotes/v2</code>, que trae información más completa sobre los autores:</p>
<pre><code class="lang-json">{
  <span class="hljs-string">"quote"</span>: <span class="hljs-string">"December used to be a month but it is now a year"</span>,
  <span class="hljs-string">"source"</span>: <span class="hljs-string">"Letters from a Stoic"</span>,
  <span class="hljs-string">"author"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Seneca"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">68</span>,
    <span class="hljs-string">"origin"</span>: <span class="hljs-string">"Cordoba"</span>
  },
  <span class="hljs-string">"year"</span>: <span class="hljs-number">54</span>
}
</code></pre>
<p>Podemos manejar esta nueva situación anidando nuestros pequeños decodificadores:</p>
<pre><code class="lang-elm"><span class="hljs-keyword">import</span> Json.Decode <span class="hljs-keyword">exposing</span> (<span class="hljs-type">Decoder</span>, field, int, map2, map4, string)


<span class="hljs-keyword">type</span> <span class="hljs-keyword">alias</span> <span class="hljs-type">Quote</span> =
    { quote : <span class="hljs-type">String</span>
    , source : <span class="hljs-type">String</span>
    , author : <span class="hljs-type">Person</span>
    , year : <span class="hljs-type">Int</span>
    }


<span class="hljs-title">quoteDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">Quote</span>
<span class="hljs-title">quoteDecoder</span> =
    map4 <span class="hljs-type">Quote</span>
        (field <span class="hljs-string">"quote"</span> string)
        (field <span class="hljs-string">"source"</span> string)
        (field <span class="hljs-string">"author"</span> personDecoder)
        (field <span class="hljs-string">"year"</span> int)


<span class="hljs-keyword">type</span> <span class="hljs-keyword">alias</span> <span class="hljs-type">Person</span> =
    { name : <span class="hljs-type">String</span>
    , age : <span class="hljs-type">Int</span>
    }


<span class="hljs-title">personDecoder</span> : <span class="hljs-type">Decoder</span> <span class="hljs-type">Person</span>
<span class="hljs-title">personDecoder</span> =
    map2 <span class="hljs-type">Person</span>
        (field <span class="hljs-string">"name"</span> string)
        (field <span class="hljs-string">"age"</span> int)
</code></pre>
<p>Fíjate en que no nos hemos molestado en decodificar el campo <code>"origin"</code> del autor. Un decodificador bien puede ignorar campos, lo cual es útil si sólo necesitamos extraer información parcial desde valores JSON relativamente grandes.</p>
<h2 id="siguientes-pasos">Siguientes pasos</h2>
<p>Hay muchas funciones importantes en <code>Json.Decode</code> que no hemos cubierto aquí:</p>
<ul>
<li><a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#bool" target="_blank"><code>bool</code></a> : <code>Decoder Bool</code></li>
<li><a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#list" target="_blank"><code>list</code></a> : <code>Decoder a -&gt; Decoder (List a)</code></li>
<li><a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#dict" target="_blank"><code>dict</code></a> : <code>Decoder a -&gt; Decoder (Dict String a)</code></li>
<li><a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#oneOf" target="_blank"><code>oneOf</code></a> : <code>List (Decoder a) -&gt; Decoder a</code></li>
</ul>
<p>Existen formas de extraer todo tipo de estructuras de datos. La función <code>oneOf</code> es particularmente útil cuando tenemos datos JSON poco normalizados. Por ejemplo, si a veces trae un <code>Int</code> y otras veces trae dígitos en formato <code>String</code>… Puede llegar a ser muy molesto.</p>
<p>Vimos cómo se usan <a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#map2" target="_blank"><code>map2</code></a> y <a href="https://package.elm-lang.org/packages/elm/json/latest/Json-Decode#map4" target="_blank"><code>map4</code></a> para lidiar con objetos con muchos campos. Pero cuando empieces a trabajar con objetos JSON más y más grandes, vale la pena revisar <a href="https://package.elm-lang.org/packages/NoRedInk/elm-json-decode-pipeline/latest" target="_blank"><code>NoRedInk/elm-json-decode-pipeline</code></a>. Sus tipos son un poco más complicados, pero mucha gente encuentra sus funciones más fáciles de leer y de usar.</p>
<blockquote>
<p><strong>Dato curioso:</strong> He oído varias historias de gente que encuentra bugs en su código de <em>servidor</em> después de migrar de JS a Elm, porque los decodificadores que escriben acaban siendo una etapa de validación que identifica errores extraños en los valores JSON. Por ejemplo, cuando NoRedInk migró de usar React a usar Elm, salieron a la luz algunos bugs en su código Ruby.</p>
</blockquote>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="http.html" class="navigation navigation-prev " aria-label="Previous page: HTTP">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="random.html" class="navigation navigation-next " aria-label="Next page: Valores aleatorios">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"JSON","level":"1.6.2","depth":2,"next":{"title":"Valores aleatorios","level":"1.6.3","depth":2,"path":"effects/random.md","ref":"effects/random.md","articles":[]},"previous":{"title":"HTTP","level":"1.6.1","depth":2,"path":"effects/http.md","ref":"effects/http.md","articles":[]},"dir":"ltr"},"config":{"plugins":["youtube","elm-repl","bulk-redirect","-sharing"],"root":"book","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"bulk-redirect":{"basepath":"/","redirectsFile":"redirects.json"},"youtube":{},"elm-repl":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Evan Czaplicki","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56},"embedFonts":false},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Introducción a Elm","gitbook":"*","description":"Aprende Elm. Construye aplicaciones. Aprende programación funcional."},"file":{"path":"effects/json.md","mtime":"2024-10-05T14:49:20.305Z","type":"markdown"},"gitbook":{"version":"5.1.4","time":"2024-10-05T14:49:58.179Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <noscript>
        <style>
            .honkit-cloak {
                display: block !important;
            }
        </style>
    </noscript>
    <script>
        // Restore sidebar state as critical path for prevent layout shift
        function __init__getSidebarState(defaultValue){
            var baseKey = "";
            var key = baseKey + ":sidebar";
            try {
                var value = localStorage[key];
                if (value === undefined) {
                    return defaultValue;
                }
                var parsed = JSON.parse(value);
                return parsed == null ? defaultValue : parsed;
            } catch (e) {
                return defaultValue;
            }
        }
        function __init__restoreLastSidebarState() {
            var isMobile = window.matchMedia("(max-width: 600px)").matches;
            if (isMobile) {
                // Init last state if not mobile
                return;
            }
            var sidebarState = __init__getSidebarState(true);
            var book = document.querySelector(".book");
            // Show sidebar if it enabled
            if (sidebarState && book) {
                book.classList.add("without-animation", "with-summary");
            }
        }

        try {
            __init__restoreLastSidebarState();
        } finally {
            var book = document.querySelector(".book");
            book.classList.remove("honkit-cloak");
        }
    </script>
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-elm-repl/repl.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

